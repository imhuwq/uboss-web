<% if params[:redirect] == 'discourse' %>
  <%= content_for :title do %>
    <%= Rails.application.secrets.metas["discourse_title"] %>
  <% end %>
<% end %>

<%= content_for :page_title do %>
  <% if params[:redirect] == 'discourse' %>
    <%= Rails.application.secrets.metas["discourse_page_title"] %>
  <% else %>
    登录UBOSS
  <% end %>
<% end %>

<div class='login-container <%= @using_password ? 'using-pwd' : 'using-cap' %>'>
  <%= simple_form_for(resource, as: resource_name, url: session_path(resource_name, redirect: params[:redirect])) do |f| %>
    <% if params[:redirect] == 'discourse' %>
      <h2><%= Rails.application.secrets.metas["discourse_head"] %></h2>
    <% else %>
      <h2>UBOSS</h2>
    <% end %>
    <hr />

    <div class='login-type-acs clearfix'>
      <a class="lpwd-btn" href="#">已有账户</a>
      <a class="lcap-btn" href="#">验证码登陆/注册</a>
    </div>

    <div class="form-inputs">
      <%= f.input :login, required: false, autofocus: true, input_html: {id: 'new_mobile'} %>

      <div class="cap-inputs">
        <%= f.input :image_captcha do %>
          <div class='simple-captcha'>
            <div class="simple-captcha-img">
              <%= mobile_login_simple_captcha_components[:image] %>
            </div>
            <div class="simple-captcha-field">
              <%= mobile_login_simple_captcha_components[:field] %>
            </div>
            <%= mobile_login_simple_captcha_components[:refresh_button] %>
          </div>
        <% end %>

        <%= f.input :mobile_auth_code do %>
          <%= f.input_field :mobile_auth_code, class: 'form-control' %>
          <a id="request_mobile_captcha" class="send_mobile" href="#">发送验证码</a>
        <% end %>

      </div>
      <div class="cap-inputs form-group">
        <small>未开通UBOSS账号的用户，点击确认表明您已同意<a href="<%= agreements_register_path %>">《UBOSS用户注册协议》</a>，自动为您开通UBOSS账号</small>
      </div>

      <div class='pwd-inputs'>
        <%= f.input :password, required: false %>
        <%= f.input :remember_me, as: :boolean, label_html: {class:'pull-right'}, label: '下次自动登录' if devise_mapping.rememberable? %>
      </div>

    </div>

    <div class="button_div">
      <%= f.button :submit, "确认", class: "btn btn-large btn-primary col-xs-12" %>
    </div>

    <% if !browser.wechat? %>
      <div class="button_div  col-xs-12"  style="margin: 10px 0 10px 0;">
        <% if params[:redirect] == 'discourse' %>
          <%= link_to "返回主页", Rails.application.secrets.discourse['url'], class: "btn btn-large btn-link col-xs-12"%>
        <% else %>
          <%= link_to "返回主页", root_path, class: "btn btn-large btn-link col-xs-12"%>
        <% end %>
      </div>
    <% end %>
  <% end %>
</div>
