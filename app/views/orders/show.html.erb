<%= content_for :page_title do %>
  <%= flash[:order_confirm].present? ? '确认订单' : @order.state_i18n %>
<% end %>

<div class="container">
  <div class="subOrd_box1">
    <dl>
      <dt>
        <%= image_tag @product.image_url(:thumb) %>
      </dt>
      <dd>
        <strong><%= @product.name %><span>￥<%= @order_item.present_price %></span></strong>
        <p><%= @product.user.store_name %></p>
      </dd>
    </dl>
  </div>
  <div class="subOrd_box2">
    <div class="subOrd_boxcont">
      <p class="sub_p1">
        <span class="sub_left">数量</span>
        <span class="sub_right sub_num">
          <a href="#"><%= @order_item.amount %></a>
        </span>
      </p>
      <p class="sub_p1 sub_p2">
        <span class="sub_leftl">合计（含运费￥<%= @product.traffic_expense %>）</span>
        <span class="sub_left">
          <strong>￥</strong><b id="total_price"><%= @order.pay_amount %></b>
        </span>
      </p>
    </div>

    <div class="sub_p3">个人信息</div>

  </div>
</div>

<div class="sub_box3">
  <div class="sub_box3_cont">
    <div class="sub_box3_cont1">
      <table width="100%" border="1" class="table1">
        <tr>
          <td><span>收件人：</span></td>
          <td><span>电话：</span></td>
        </tr>
        <tr>
          <td class="hidd"><%= @order.username %></td>
          <td class="hidd"><%= @order.mobile %></td>
        </tr>
        <tr>
          <td colspan="3"><span>收件地址：</span></td>
        </tr>
        <tr>
          <td colspan="3" class="hidd"><%= @order.address %></td>
        </tr>
      </table>
    </div>
  </div>
</div>

<br/>

<% if @order.state == 'unpay' && browser.wechat? %>
  <div class="accunt_adil_box3">
    <%= link_to "支付", '#', id: 'wx-pay-btn', class: 'accunt_adilbtn' %>
  </div>
<% end %>

<% if @order.state == 'unpay' && browser.wechat? %>
  <%= content_for :extra_javascript do %>
    <script type="text/javascript" charset="utf-8">
  wx.ready(function(){

    $('#wx-pay-btn').on('click', function(event){
      event.preventDefault();
      wx.chooseWXPay({
        "timestamp": "<%= @pay_p[:timeStamp] %>",
        "nonceStr": "<%= @pay_p[:nonceStr] %>",
        "package": "<%= @pay_p[:package] %>",
        "signType": "<%= @pay_p[:signType] %>",
        "paySign": "<%= @pay_sign %>", // 支付签名
        "success": function (res) {
          window.location.href = "/orders/" + "<%= @order.id %>" + "/pay_complete";
        }
      });

    });

    wx.hideOptionMenu();

  })
      </script>
  <% end %>
<% end %>
