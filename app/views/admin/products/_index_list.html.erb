<%= render 'layouts/flash_alert' if action_name == "change_status" %>
<%= table_for(@products) do |t| %>
  <%= t.cell :name do |obj| %>
    <%= link_to [:admin, obj] do %>
    <div class="" style="width:370px;float:left;">
      <div class="col-sm-3">
        <%= image_tag(obj.image_url(:thumb), size: "100x80", alt: "-") %>
      </div>
      <div class="col-sm-9"  style="padding-top:15px;">
        <div class="col-sm-12">商品名称：<%= obj.name %></div>
        <div class="col-sm-12">价格：<%= obj.present_price %></div>
      </div>
    </div>

    <% end %>
  <% end %>
  <%= t.cell :good_reputation do |obj| %>
  <%= Evaluation.product_good_reputation_rate(obj.id) %>
  <% end %>
  <%= t.cell :count %>
  <%= t.cell :total_sells do |obj| %>
  <%= obj.total_sells %>
  <% end %>
  <%= t.cell :created_at %>
  <%= t.cell :methods do |obj| %>
  <div style="padding-top:15px;width:240;float:left;">
    <div class="col-xs-4">
      <%= link_to("编辑", url_for(:action=>:edit,:id=>obj.id), class:"btn btn-xs btn-warning",style:"margin-bottom:5px;")%>
      <br />
      <%= link_to("删除",  '###', onclick:"delete_this(#{obj.id})", class:"btn btn-xs btn-danger") %>
    </div>
    <div class="col-xs-5">
      <% if obj.status == 'unpublish' %>
      <%= link_to("上架",'###', onclick:"change_status(#{obj.id},'published')", class:"btn btn-large btn-success", style:"height:50px;padding:14px 22px 0 22px;") %>
      <% else %>
      <%= link_to("取消上架", '###', onclick:"change_status(#{obj.id},'unpublish')", class:"btn btn-large btn-default", style:"height:50px;padding:14px 8px 0 8px;") %>
      <% end %>
    </div>
  </div>


  <% end %>
<%- end %>
<%= paginate @products %>

<script type="text/javascript">
$(document).on('ready page:load', function() {
var mobile = ''
$("#save_mobile_mobile").on('keyup', this, function(event) {
  mobile = event.target.value
  var checkNum = /^(\+\d+-)?[1-9]{1}[0-9]{10}$/;
  if (checkNum.test(mobile)) {$("#save_mobile_submit").removeAttr('disabled');};
  if (!checkNum.test(mobile)) {$("#save_mobile_submit").attr('disabled','disabled');};
});

})
</script>
<script type="text/javascript">
function change_status(id,status) {
  var id = id
  console.log(id)
  $.ajax({
    url: '/admin/products/'+id+'/change_status',
    dataType: 'script',
    data: {id: id,status: status, page: <%= params[:page] || 1 %>},
  })
  .done(function() {
    console.log("success");
  })
  .fail(function() {
    console.log("error");
  })
  .always(function() {
    console.log("complete");
  });

}
function delete_this(id) {
  var id = id
  console.log(id)
  var r=confirm("确定要删除么？")
  if (r==true) {
    $.ajax({
      url: '/admin/products/'+id+'/change_status',
      dataType: 'script',
      data: {id: id, status: 'closed'},
    })
    .done(function() {
      console.log("success");
    })
    .fail(function() {
      console.log("error");
    })
    .always(function() {
      console.log("complete");
    });
  };


}
</script>
<style media="screen">
  .product td{}
</style>
