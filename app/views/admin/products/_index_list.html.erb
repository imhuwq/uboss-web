<%= table_for(@products) do |t| %>
  <%= t.cell :name do |obj| %>
    <%= link_to [:admin, obj] do %>
    <div class="col-sm-3">
      <%= image_tag("http://#{obj.asset_img.try(:avatar).try(:url)}", size: "100x80", alt: "-") %>
    </div>
    <div class="col-sm-9">
      <div class="col-sm-12">商品名称：<%= obj.name %></div>
      <div class="col-sm-12">价格：<%= obj.present_price %></div>
    </div>
    <% end %>
  <% end %>
  <%= t.cell :good_reputation do |obj| %>
  <%= Evaluation.product_good_reputation_rate(obj.id) %>
  <% end %>
  <%= t.cell :count %>
  <%= t.cell :total_sells do |obj| %>
  <%= Product.total_sells(obj) %>
  <% end %>
  <%= t.cell :created_at %>
  <%= t.cell :methods do |obj| %>
    <%= link_to("编辑", url_for(:action=>:edit,:id=>obj.id)) %>
    <br>
    <% if obj.status == 0 %>
    <%= link_to("上架",'###', onclick:"change_status(#{obj.id})") %>
    <% else %>
    <%= link_to("取消上架", '###', onclick:"change_status(#{obj.id})") %>
    <% end %>
    <br>
    <%= link_to("删除",  '###', onclick:"delete_this(#{obj.id})") %>
  <% end %>
<%- end %>
<%= paginate @products %>

<script type="text/javascript">
$(document).on('ready page:load', function() {
var mobile = ''
$("#save_mobile_mobile").on('keyup', this, function(event) {
  mobile = event.target.value
  var checkNum = /^(\+\d+-)?[1-9]{1}[0-9]{10}$/;
  if (checkNum.test(mobile)) {$("#save_mobile_submit").removeAttr('disabled');};
  if (!checkNum.test(mobile)) {$("#save_mobile_submit").attr('disabled','disabled');};
});

})
</script>
<script type="text/javascript">
function change_status(id) {
  var id = id
  console.log(id)
  $.ajax({
    url: '/admin/products/'+id+'/change_status',
    dataType: 'script',
    data: {id: id},
  })
  .done(function() {
    console.log("success");
  })
  .fail(function() {
    console.log("error");
  })
  .always(function() {
    console.log("complete");
  });
  
}
function delete_this(id) {
  var id = id
  console.log(id)
  var r=confirm("确定要删除么？")
  if (r==true) {
    $.ajax({
      url: '/admin/products/'+id+'/change_status',
      dataType: 'script',
      data: {delete: true},
    })
    .done(function() {
      console.log("success");
    })
    .fail(function() {
      console.log("error");
    })
    .always(function() {
      console.log("complete");
    });
  };
  
  
}
</script>