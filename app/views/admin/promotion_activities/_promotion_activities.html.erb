<div class="products_wrapper">
  <%= render 'layouts/flash_alert' if request.xhr? %>
  <div class="index_list">
    <table class="list-table" id="promotion_activities">
      <thead>
        <th colspan="2">商家名称</th>
        <th>活动类型</th>
        <th>活动名称</th>
        <th>中奖数量</th>
        <th>已中奖数量</th>
        <th>已验证数量</th>
        <th>参与时间</th>
        <th>操作</th>
      </thead>
      <% promotion_activities.each do |promotion_activity| %>

        <% live_activity_info = promotion_activity.live_activity_info %>
        <% share_activity_info = promotion_activity.share_activity_info %>
        <tr class="promotion_activity">
          <td rowspan="2">
            <%= link_to admin_promotion_activity_path(promotion_activity) do %>
              <%= image_tag(promotion_activity.user.image_url(:thumb), size: "80x80", alt: "-") %>
            <% end %>
          </td>
          <td rowspan="2" class="text-left" style="max-width: 400px;">
            <%= link_to promotion_activity.user.nickname, admin_promotion_activity_path(promotion_activity) %>
          </td>
          <td><%= translate_activity_type live_activity_info.activity_type %></td>
          <td><%= live_activity_info.name %></td>
          <td><%= live_activity_info.win_count %></td>
          <td><%= live_activity_info.live_prizes.count %></td>
          <td><%= live_activity_info.verified_verify_codes.count %></td>
          <td rowspan="2"><%= promotion_activity.created_at %></td>
          <td rowspan="2">
            <% if promotion_activity.status == 'unpublish' %>
              <p>
              <%= link_to("上架", change_status_admin_promotion_activity_path(promotion_activity, status: 'published'),
              remote: true, method: :patch, data: { disable_with: '<i class="fa fa-spinner"></i>' },
              class: "btn btn-mid btn-block yellow-btn change-status-btn") %>
              </p>
              <%= link_to "查看详情", admin_promotion_activity_path(promotion_activity), style: "font-size:12px;" %>
            <% else %>
              <p>
              <%= link_to("下架", change_status_admin_promotion_activity_path(promotion_activity, status: 'unpublish'),
              remote: true, method: :patch, data: { disable_with: '<i class="fa fa-spinner"></i>' },
              class: "btn btn-mid btn-block change-status-btn") %>
              </p>
              <%= link_to "查看详情", admin_promotion_activity_path(promotion_activity), style: "font-size:12px;" %>
            <% end %>
          </td>
        </tr>

        <tr class="promotion_activity">
          <td><%= translate_activity_type share_activity_info.activity_type %></td>
          <td><%= share_activity_info.name %></td>
          <td><%= share_activity_info.win_count %></td>
          <td><%= share_activity_info.share_prizes.count %></td>
          <td><%= share_activity_info.verified_verify_codes.count %></td>
        </tr>

      <% end %>
    </table>
  </div>
</div>
